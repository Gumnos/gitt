<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-228354-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 8</h1><h2>"Fishing for beginners"</h2>
<h3>Hooking your scripts up</h3>
So we come to the last After Hours section of the book and this time we are going to take a look at hook scripts.
Hook scripts are tiny pieces of code that you are allowed to have executed at certain points during Git's processes which can affect the outcome of those same processes.
Imagine for example that whenever you committed to a repository you wanted an email to be sent to the project manager.
That is a job for a hook script.<br><br>The are a fairly large number of hook points available.
They are called hooks because it allows you to hook something else into the Git process.
Below is a list of a few of the available hook points along with a very brief description of when they are triggered and how they can affect the process.
For a full list, you should check out the manual for githooks.<br><div style="padding-left:10px;"><ul><li><strong>applypatch-msg</strong> - Invoked by <code class="ncode">git am</code>, it is provided with the name of the proposed commit message for the patch and allows for sanitisation.
Exiting with a non-zero status will cause <code class="ncode">git am</code> to abort the patch.
Will run the <strong>commit-msg</strong> hook if enabled.</li>
<li><strong>pre-applypatch</strong> - Invoked by <code class="ncode">git am</code>, it runs immediately after the patch is applied, but before a commit is made.
In this way, checks can be made to the working tree before committing.
Exiting with non-zero status aborts the commit.
Will run the <strong>pre-commit</strong> hook if enabled.</li>
<li><strong>post-applypatch</strong> - Invoked by <code class="ncode">git am</code>, it runs after the patch is applied and the commit is made.
It does not affect the flow of <code class="ncode">git am</code> and as such is useful for actions such as notifications.</li>
<li><strong>pre-commit</strong> - This hook is invoked by <code class="ncode">git commit</code> and can be bypassed with the <code class="ncode">--no-verify</code> option.
Exiting with non-zero status aborts the commit.</li>
<li><strong>prepare-commit-msg</strong> - This hook is invoked by <code class="ncode">git commit</code> and is run immediately after the commit message has been prepared, but before the message editor has been loaded.
It takes three parameters, the file containing the log message, the source of the commit message and an SHA hash.
Exiting with non-zero status aborts the commit.
It should not be used to replace <strong>pre-commit</strong>.</li>
<li><strong>commit-msg</strong> - This hook is invoked by <code class="ncode">git commit</code> and can be bypassed with the <code class="ncode">--no-verify</code> option.
The hook is used to normalise messages in place before commit.
Exiting with non-zero status aborts the commit.</li>
<li><strong>post-commit</strong> - Invoked by <code class="ncode">git commit</code>, it runs immediately after a commit is made.
It can not affect the flow of <code class="ncode">git commit</code> and as such is useful for actions such as notifications.</li>
<li><strong>pre-rebase</strong> - Invoked by <code class="ncode">git rebase</code>, it is useful for preventing a branch from being rebased.</li>
<li><strong>post-checkout</strong> - Invoked by <code class="ncode">git checkout</code> after it has updated the working tree.
The hook is given the ref of the previous HEAD, the new HEAD and a flag indicating if it was a branch or file checkout.
It is also invoked after <code class="ncode">git clone</code>, but can be overidden by the use of <code class="ncode">--no-checkout</code>.
The script is most useful for performing sanity and validity checks on the working tree post checkout.
It does not affect the process of <code class="ncode">git clone</code> or <code class="ncode">git checkout</code></li>
<li><strong>post-merge</strong> - Invoked by <code class="ncode">git merge</code> when run as part of a <code class="ncode">git pull</code>.
It does not affect the outcome of the merge, but does not get executed if the merge fails due to conflicts.</li>
</ul></div><br>So we have a large arsenal of hooks that we can employ to assist us in administrating our repository.
We are going to set up a fairly simple example here of ensuring that we do not delete one of our core files.
To begin with, let us add a <code class="ncode">corefile</code> to the repository in a new branch and play a little with a new hook script.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout -b hooktest</strong><br/>
Switched to a new branch 'hooktest'<br/>
<strong>john@satsuki:~/coderepo$ echo "Very Important File" &gt; corefile</strong><br/>
<strong>john@satsuki:~/coderepo$ git add corefile</strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Added Core File'</strong><br/>
[hooktest 96fe8b9] Added Core File<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
 create mode 100644 corefile<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now let us create a hook script called <code class="ncode">.git/hooks/pre-commit</code>, with the following code.<br><div id="codeblock"><code>#!/bin/bash<br/>
<br/>
if [ -e "corefile" ] <br/>
then<br/>
	echo "File OK"<br/>
	exit 0<br/>
else<br/>
	echo "File Deleted Not Committing"<br/>
	exit 2<br/>
fi<br/>
</code></div><br>Now let us see what happens if we make a commit that does not affect the <code class="ncode">corefile</code>.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ echo "New Development" &gt;&gt; cont_dev </strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Added a commit'</strong><br/>
File OK<br/>
[hooktest 73656f2] Added a commit<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>We see the text <code class="ncode">File OK</code> in the output, which indicates that the commit is allowed to go ahead.
What happens if we try to remove the core file and commit the result?<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git rm corefile</strong><br/>
rm 'corefile'<br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Removed a corefile'</strong><br/>
File Deleted Not Committing<br/>
<strong>john@satsuki:~/coderepo$ </strong><br/>
</code></div><br>We have been prevented from committing because we removed the all important <code class="ncode">corefile</code>.
To be able to commit again, we must return the file.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout HEAD -- corefile</strong><br/>
<strong>john@satsuki:~/coderepo$ ls</strong><br/>
another_file  cont_dev  corefile  tester<br/>
<strong>john@satsuki:~/coderepo$ echo "New development" &gt;&gt; cont_dev </strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Some more development'</strong><br/>
File OK<br/>
[hooktest 6786dd5] Some more development<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>So you see hooks can be really simple, or they can do highly complex things.
Imagine a hook that would compile the code in the working tree prior to the commit and only allow it to continue if the code compiled cleanly.
That could be pretty useful in ensuring that there is always good clean buildable code in the repository.<table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap8-6.html"><img src="images/prev.png" alt="Previous Day" height="29" border="0"></a></p></td>
						<td><p align="right"><a href="chap9-1.html"><img src="images/next.png" alt="Next Day" height="29" border="0"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="read.html">read now</a> | <a href="source.html">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
