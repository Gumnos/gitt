<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-228354-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 4</h1><h2>Day 3 - "Tricking the twigs"</h2>
<h3>More neat ways to work with branches</h3>
This is only the beginning of the fantastic feature set that Git offers.
By knowing how Git handles your data, you can make it work for you.
Let us take a look at another situation you may find yourself in.<br><div id="trenchblock"><strong>In the trenches...</strong><br>
"Rob!" shouted Simon for the fourth time that morning.
"Rob, I made a real boo boo this time."<br><br>Rob walked over to Simon again, head lolling back on his shoulders and his eyes rolling.
His arms weighed heavily by his side and his walk reminded Simon of that of a zombie.<br><br>"What have you done THIS time?" asked the developer as he reached the desk.<br><br>Simon drew in his breath deeply, "Well, I created a branch, started working away, committing like a good'un, but I only just realised I'm on the wrong branch. I forgot to switch."
He hung his head in shame.
"I'm screwed right?"<br><br>"Not necessarily," replied his colleague.
</div><br>This wouldn't work in all situations, but then there are other techniques described later in the book to deal with more special cases.
In this scenario we have created a branch, forgotten to switch into it, and carried on committing as if we were in our new branch.
At first glance it may seem as if we are stuck.
Once we have committed, we can't undo those commits right? Well, that's not entirely accurate.<br><br>We actually have two ways of clearing up this particular situation.
The first of these is to use <code class="ncode">git revert</code> to undo the changes of each commit.
Whilst this will work, we have two problems, a) we do not know how to use the <code class="ncode">git revert</code> tool yet, and b) we can actually handle this situation much more cleanly.
We are going to make a new branch, make a few commits and then look at a diagram of our recent work to see how we can work things out.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout master</strong><br/>
Already on 'master'<br/>
<strong>john@satsuki:~/coderepo$ git branch zaney</strong><br/>
<strong>john@satsuki:~/coderepo$ echo "and some awesome changes" &gt;&gt; newfile1</strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Made an awesome change'</strong><br/>
[master a27d49e] Made an awesome change<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$ echo "and some more awesome changes" &gt;&gt;</strong><br/>
 newfile2<br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Made another awesome change'</strong><br/>
[master 7cc32db] Made another awesome change<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w4-d3.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 3</strong><br>Repository including the mistake</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w4-d4.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 4</strong><br>Repository showing how things <em>should</em> look</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>Figure 3 shows how our repository looks now, whereas Figure 4 shows how the repository should have looked if we had performed it properly.
You should notice that the positions of <code class="ncode">master</code> and <code class="ncode">zaney</code> have switched places.
How can we rectify this?<br><br>We already discussed one method using <code class="ncode">git revert</code>, which we are due to cover a little later.
However, because of the way that the history has been written, we can do something very simple.
We are going do the following the following steps.<br><div style="padding-left:10px;"><ol><li>Switch to our <strong>zaney</strong> branch</li>
<li>Fast-forward our zaney branch so that it points to the same commit using a merge</li>
<li>Switch back to our <strong>master</strong> branch</li>
<li>Reset our master branch back to the required point in time</li>
</ol></div><br>So let us take a look at the command line output and see how we achieve this.
Hopefully you should be familiar with most of the commands.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout zaney</strong><br/>
Switched to branch 'zaney'<br/>
<strong>john@satsuki:~/coderepo$ git merge master</strong><br/>
Updating 9710177..7cc32db<br/>
Fast-forward<br/>
 newfile1 |    1 +<br/>
 newfile2 |    1 +<br/>
 2 files changed, 2 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$ git checkout master</strong><br/>
Switched to branch 'master'<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now we reach step 4 in our set of instructions.
The one function we do not know how to perform yet is the resetting of our branch back to a previous point in time.
The point we need to rewind back to is the point that we initially created the <strong>zaney</strong> branch at.
We could have gotten this information by using <code class="ncode">git log</code>.
Instead, this time we can use the information presented in the merge output to show the common ancestor, which has to be the point that we created our branch at.
In this case it is commit <strong>9710177</strong>.<br><br>We are now going to perform the last step using an old friend called <code class="ncode">git reset</code>.
You may be thinking that <code class="ncode">git reset</code> is only used to reset files in the index, but in fact, <code class="ncode">git reset</code> can actually perform many more tasks.
We are going to use it with the <code class="ncode">--hard</code> option.
This option can be dangerous, as it will discard all modifications in the working tree, so use with caution.
If we had uncommitted changes in our repository at this point, we could not have used this option.
Let's use the command and see where we get.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git reset --hard 9710177</strong><br/>
HEAD is now at 9710177 Added another file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>As you can see, we are told that the HEAD of our master branch is now at commit <strong>9710177</strong>.
We have successfully rewound our <strong>master</strong> branch to a previous state.
The <code class="ncode">--hard</code> parameter reset the index and the working tree to be at the state of the commit we tell it to.
It disregards all working copy and staged modifications, so use it with care.<br><br>The <code class="ncode">git reset</code> command does not only work for rewinding back in time.
It can also be used to move a branch forward in time.
As an example of this, we used a fast-forward merge to move our <strong>zaney</strong> branch forward to be in-line with master.
We could just have easily used <code class="ncode">git reset --hard 7cc32db</code> from within the zaney branch, to bring it to the same point as the master.
In fact, though it looks scary, we could also have used <code class="ncode">git reset --hard master</code> to reset the <strong>zaney</strong> branch to be at the same point as <strong>master</strong>.
Saves typing out those horrid commits does it not?<br><br>Finally we are going to introduce one more use of the <code class="ncode">git log</code> command to show us how our repository looks in a semi-graphical way.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log --graph --pretty=oneline --all --abbrev-commit  --decorate</strong><br/>
* 7cc32db (zaney) Made another awesome change<br/>
* a27d49e Made an awesome change<br/>
| * cfbecab (wonderful) Fantastic new feature<br/>
|/<br/>
* 9710177 (HEAD, wacky, master) Added another file<br/>
* 55fb69f (v2.0) Added two new files<br/>
* 4a155e4 Removed a few files<br/>
* a022d4d (tag: v1.0b, v1.0a) Messed with a few files<br/>
* 9938a0c Finished adding initial files<br/>
* 163f061 (v0.9) Made a few changes to first and second files<br/>
* cfe23cb My First Ever Commit<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>The <code class="ncode">--graph</code> parameter, tells Git to draw a graph down the left hand column.
The <code class="ncode">--pretty=oneline</code> parameter reduces the commit details to one line, else we see the entire log message of the commit.
<code class="ncode">--all</code> shows all branches.
The <code class="ncode">abbrev-commit</code> in the command tells Git to abbreviate the commit IDs to a sensible length.
Finally, <code class="ncode">--decorate</code> shows us the tag and branch references.
Hopefully if you compare this tree to the diagram earlier, you will see that the tree is actually completely in order.<br><br>Be aware that during this work we have changed the history of at least one of our branches.
Had we pushed our changes to a public server, which is something that will be discussed next week, we would have to force these changes to be accepted at the server end.
Git knows we are trying to change a past that may have been viewed by others and will warn us accordingly.<br><br><table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap4-2.html"><img src="images/prev.png" alt="Previous Day" height="29" border="0"></a></p></td>
						<td><p align="right"><a href="chap4-4.html"><img src="images/next.png" alt="Next Day" height="29" border="0"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="read.html">read now</a> | <a href="source.html">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
