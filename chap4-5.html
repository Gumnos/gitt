<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-228354-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 4</h1><h2>Day 5 - "Conflicting information"</h2>
<h3>What to do when it all goes wrong</h3>
The team have been playing with branches for a few days now and are beginning to settle into the idea of branching often.
As you can see, in Git, a branch is a really simple device for allowing experimentation and development.
As the implementation of branches is so simple, it is also really fast to switch between branches.
If you have been keeping up with the <em>After Hours</em> sections, you can hopefully see that when switching branches, Git only needs to alter what is different between one working copy and another.<br><br>Let us see what new issues the team runs into during Week 4.<br><div id="trenchblock"><strong>In the trenches...</strong><br>
"Hmm," the puzzled noise reverberated round Klaus' corner of the office.
Mumbling commenced.
"So if I did that, then why is that not ... I mean I didn't think ... that's probably the problem Klaus ... sill 'luser'."
He chuckled to himself, hardly noticing the looming figure of John.<br><br>"You got a conflict," said John matter of factly.<br><br>"I can see that," came Klaus' reply.
"The problem is how do I solve it"<br><br>"What were you doing?"<br><br>"Well I had a few branches I had been working on and I was trying to merge them in."<br><br>"Figures," said John.
</div><br>Conflicts are bound to happen at some point.
Even the best project processes in the world will sometimes end up with a conflict that has to be resolved.
We should, at this point, clarify what a conflict actually is.
A conflict occurs when an attempt is made to reconcile multiple changes to the same section of a file at the same time.
This usually means that the same line of code is modified by two different parties at the same time.
Now that we have several branches in our test repository, let us merge them back into master and see if we come up with a conflict.<br><br>First we are going to add a little change to one of our files.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ echo "Another update to this file" &gt;&gt; my_third_committed_file</strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Updated third file'</strong><br/>
[master 4ac9201] Updated third file<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now let us merge in our <strong>wonderful</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git merge wonderful</strong><br/>
Merge made by recursive.<br/>
 newfile1 |    1 +<br/>
 newfile2 |    1 +<br/>
 2 files changed, 2 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>So far, our merge has gone pretty well.
We have taken all of the changes that were made in the <strong>wonderful</strong> branch and pulled them into our <strong>master</strong> branch.
If we wanted to, we could continue on making changes to the <strong>wonderful</strong> branch and we could keep pulling changes in from one to the other as time went by.
Figure 5 shows what our repository looks like now.<br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w4-d5.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 5</strong><br>Repository state after <strong>wonderful</strong> merge</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>Our repository tree looks a little strange now.
Notice that the most recent commit, <strong>b119573</strong>, has two parents.
Can this be true? If we run our <code class="ncode">git show</code> command against that commit ID, we see something new.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git show b119573</strong><br/>
commit b119573f4508514c55e1c4e3bebec0ab3667d071<br/>
Merge: 4ac9201 cfbecab<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Fri Apr 1 07:35:13 2011 +0100<br/>
<br/>
    Merge branch 'wonderful'<br/>
<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Notice the line <code class="ncode">Merge: 4ac9201 cfbecab</code>, which simply tells us that this is a special type of commit, a merge commit.
When we previously performed a merge, the branch we were merging back into had not changed since we branched off and did our development work.
If you remember, we called this a <em>fast-forward</em> merge, simply because we moved our <em>destination</em> branch forwards to meet the tip of the development branch.<br><br>This time things are a little different.
During out development time on <strong>wonderful</strong>, something changed on <strong>master</strong>.
We did not make many alterations, but just the fact that we made some changed the way the merge was performed.
In fact, we can see this if we look at the first line after the merge.
Instead of indicating a <em>fast-forward</em> merge, it now states that the merge was <em>recursive</em>.
If you are interested in the different types of merge algorithms, you should read the <em>After Hours</em> section for this chapter.<br><br>So now the history of this latest commit actually relies on two previous commits.
The changes that have been introduced in these commits are merged together to form a combined tree of files.
This is the snapshot that is represented in commit <strong>ba0bfc</strong>.<br><br>Let us now remove that third file before merging in the <strong>zaney</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git rm my_third_committed_file</strong><br/>
rm 'my_third_committed_file'<br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Removed third file'</strong><br/>
[master ed2301b] Removed third file<br/>
 1 files changed, 0 insertions(+), 2 deletions(-)<br/>
 delete mode 100644 my_third_committed_file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>So now we are ready to merge in the <strong>zaney</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git merge zaney</strong><br/>
Auto-merging newfile1<br/>
CONFLICT (content): Merge conflict in newfile1<br/>
Auto-merging newfile2<br/>
CONFLICT (content): Merge conflict in newfile2<br/>
Automatic merge failed; fix conflicts and then commit the result.<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Oh dear! That probably did not go as well as we had hoped.
We have two conflicts.
The first is in <code class="ncode">newfile1</code> and the second in <code class="ncode">newfile2</code>.
You may be wondering why.
The last commit we made did not make any changes to either of those files, so why do we suddenly have a conflict? When using a version control system like Git, conflicts are an every day part of life.
A conflict does not mean you have done something wrong.
It simply means that the automatic merging algorithm can not merge the changes.<br><br>In this case we have a conflict because the files have changed in both sides of the merge, since they diverged.
Rephrasing this slightly: Since the point when we created the branch <strong>zaney</strong>, at commit <strong>55fb69</strong>, both the <strong>master</strong> branch and the <strong>zaney</strong> branch have both modified the same files in the same places.
Right now, our merge is paused.
For now, let us abort the merge so that we can take a closer look at what happened.
<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git reset --merge</strong><br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>So let us compare the changes between our latest common ancestor and our branch tips.
We will first look at the difference between the ancestor and our <strong>master</strong> branch, but limit it to the files with conflicts.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git diff 55fb69 master -- newfile*</strong><br/>
diff --git a/newfile1 b/newfile1<br/>
index 24e7dfa..ef20984 100644<br/>
--- a/newfile1<br/>
+++ b/newfile1<br/>
@@ -1 +1,2 @@<br/>
 A new file<br/>
+and some more changes<br/>
diff --git a/newfile2 b/newfile2<br/>
index cba16cc..dac4357 100644<br/>
--- a/newfile2<br/>
+++ b/newfile2<br/>
@@ -1 +1,2 @@<br/>
 Another new file<br/>
+and a new feature<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now we will do the same between the common ancestor and the tip of <strong>zaney</strong>.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git diff 55fb69 zaney -- newfile*</strong><br/>
diff --git a/newfile1 b/newfile1<br/>
index 24e7dfa..d94dacc 100644<br/>
--- a/newfile1<br/>
+++ b/newfile1<br/>
@@ -1 +1,2 @@<br/>
 A new file<br/>
+and some awesome changes<br/>
diff --git a/newfile2 b/newfile2<br/>
index cba16cc..45659d7 100644<br/>
--- a/newfile2<br/>
+++ b/newfile2<br/>
@@ -1 +1,2 @@<br/>
 Another new file<br/>
+and some more awesome changes<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>So hopefully you can see that we have tried to change the second line in both files.
This is where the conflict is arising from.
Let us try to run the merge again and this time we will resolve the conflicts manually.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git merge zaney</strong><br/>
Auto-merging newfile1<br/>
CONFLICT (content): Merge conflict in newfile1<br/>
Auto-merging newfile2<br/>
CONFLICT (content): Merge conflict in newfile2<br/>
Automatic merge failed; fix conflicts and then commit the result.<br/>
<strong>john@satsuki:~/coderepo$ cat newfile1</strong><br/>
A new file<br/>
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br/>
and some more changes<br/>
=======<br/>
and some awesome changes<br/>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; zaney<br/>
<strong>john@satsuki:~/coderepo$ cat newfile2</strong><br/>
Another new file<br/>
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br/>
and a new feature<br/>
=======<br/>
and some more awesome changes<br/>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; zaney<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>We have displayed the contents of <code class="ncode">newfile1</code> and <code class="ncode">newfile2</code> during this merge.
At the moment, no commits have been made and we have a chance to tell Git exactly what these files should look like.
You should be able to see that Git has modified the files to show us what both the branches think the file should look like.
At the top, just after the <code class="ncode">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> is how the line was modified in the <strong>master</strong> branch.
We then have a divider <code class="ncode">=======</code> and after that we have the line, as it was modified in the <strong>zaney</strong> branch, followed by <code class="ncode">&gt;&gt;&gt;&gt;&gt;&gt;&gt; zaney</code>.
We can now edit these files manually, remove the dividers, header and footer and commit the result.<br><br>We are going to edit <code class="ncode">newfile1</code> to look like this:<br><div id="codeblock"><code>A new file<br/>
and some more awesome changes<br/>
</code></div><br>We will also edit <code class="ncode">newfile2</code> to look like this:<br><div id="codeblock"><code>Another new file<br/>
and a new awesome feature<br/>
</code></div><br>Now we have resolved the conflicts and set the files straight, we can add the files and commit the result.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git add newfile*</strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Merged in zaney'</strong><br/>
[master d50ffb2] Merged in zaney<br/>
<strong>john@satsuki:~/coderepo$ git log -n2</strong><br/>
commit d50ffb2fa536d869f2c4e89e8d6a48e0a29c5cc1<br/>
Merge: ed2301b 7cc32db<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Fri Apr 1 07:42:04 2011 +0100<br/>
<br/>
    Merged in zaney<br/>
<br/>
commit ed2301ba223a63a5a930b536a043444e019460a7<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Fri Apr 1 07:37:34 2011 +0100<br/>
<br/>
    Removed third file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Our merge has been completed.
Let us now see what our repository looks like graphically, in Figure 6.<br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w4-d6.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 6</strong><br>Repository state after <strong>zaney</strong> merge</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>It is quite reasonable that you may want to continue working on branches after you have integrate those changes back into your master.
Obviously you would have to merge your <strong>master</strong> branch back into <strong>zaney</strong> or any of the others, otherwise you could be developing on older versions of the code.
This brings up an interesting point which will be covered in a later chapter, as there are multiple ways to keep a development branch up to date.<br><br>So, at the end of this week, we have learnt how to create branches, how to merge them, and how to resolve conflicts.
It should be stressed that a conflict is not a <strong>bad</strong> thing.
Conflicts do happen and when they do you should simply take your time and resolve the conflict in order to represent the <em>best of both worlds</em>.
The <em>After Hours</em> section for Week 4, takes a closer look at merging and explains some more about what branches are at a repository level.<br><br><table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap4-4.html"><img src="images/prev.png" alt="Previous Day" height="29" border="0"></a></p></td>
						<td><p align="right"><a href="chap4-6.html"><img src="images/next.png" alt="Next Day" height="29" border="0"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="read.html">read now</a> | <a href="source.html">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
